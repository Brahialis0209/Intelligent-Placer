# Intelligent-Placer

## Постановка задачи

Требуется создать “Intelligent Placer”: по поданной на вход фотографии нескольких предметов на светлой горизонтальной поверхности
и многоугольнику понимать, можно ли расположить одновременно все эти предметы на плоскости так, чтобы они влезли в этот многоугольник.
Предметы и горизонтальная поверхность, которые могут оказаться на фотографии, заранее известны. 




## Исходные данные
Исходные данные можно посмотреть по [ссылке](https://github.com/Brahialis0209/Intelligent-Placer/tree/plan-and-data/data/dataset/one)

Требования к этим фотографиям

- Светлый фон
- Отсутсвие шума на изображении
- Предмет не пересекается с краем фонового листа
- Углы и края попадают на фото целиком не перекрываясь
- Освещение должно быть сверху (свет падает вертикально на объект)
- Фотографировать на расстоянии не менее 30 см
- Фотографировать со вспышкой (иначе могут быть тени)

**Пример исходных изображений**

<img src="data/dataset/one/2.jpg" width="300" height="300" /> <img src="data/dataset/one/5.jpg" width="300" height="300" />
<img src="data/dataset/one/9.jpg" width="300" height="300" /> <img src="data/dataset/one/11.jpg" width="300" height="300" />

**Задний фон**

<img src="data/dataset/one/back.jpg" width="300" height="300" />

## Входные данные
На вход подаётся фотография c несколькими предметами, описанными выше. Помимо предметов, подаётся многоугольник с обходом по часовой стрелке.
Координаты вершин многоугольника выражены в миллиметрах. 

Требования к многоугольнику:

- Замкнутая линия
- Не более 10 вершин



Входные данные можно посмотреть по [ссылке](https://github.com/Brahialis0209/Intelligent-Placer/tree/plan-and-data/data/dataset/all)

**Пример входных фотографий**

<img src="data/dataset/all/all_1.jpg" width="300" height="300" /> <img src="data/dataset/all/all_3.jpg" width="300" height="300" />
<img src="data/dataset/all/all_5.jpg" width="300" height="300" /> <img src="data/dataset/all/all_4.jpg" width="300" height="300" />


## План решения задачи
### Распознавание предметов
1. Конвертирование в градации серого, применяем Гауссово размытие и бинаризацию с порогом Оцу.
2. Убираем щели и всякий мусор с помощью морфологического закрытия.
3. Выделяем границы.
4. Убираем вложенные границы (это могут быть щели у физических объектов, нам они не интересны)

**Пример распознанных предметов**

<img src="data/dataset/all/contours.png" width="300" height="300" />

### Алгоритм размещения предметов в многоугольнике
1. Начинаем укладывать в порядке уменьшения площади, разумеется.
2. Для первого предмета выбираем рандомную позицию в многоугольнике. Главное, чтобы она была полностью внутри и не пересекала границы.
3. Начиная со второго, нам нужно его уложить так, чтобы он не пересекался с границами других предметов, а также, не оказался вложенным в другие границы.
4. Если же он пересекается или вложен в другой предмет, то мы его перемещаем вдоль границ многоугольника на определенный шаг и вращаем вокруг центр масс 
на некоторый небольшой угол. 
5. Если при всех попытках поворотов вокруг центра после каждого перемещения разместить не удается, то ответ False. Иначе, если алгоритм остановился ранее, ответ True.

### Теоретическая оптимизация алгоритма.
1. Есть варианты ускорить некоторые геометрические операции. Например, пересечение отрезков.Можно использовать алгоритм Бентли — Оттманна, проверяющий персечение отрезков
за логарифмическое время, вместо квадратного, которое получается при попарной проверке всех лтрезков на наличие пересечения.
2. Не перемещать новый предмет вдоль всех границ, если впереди стоит другой предмет. Либо, если мы попали внутрь другого предмета, сделать большой шаг. То есть перешагнуть
через него.
3. Рекурсивно перемещать предметы с прошлого шага, если никак не удается разместить новый предмет. Но, это может нас завести в бесконечное выполнение либо будет очень
не оптимально по времени.

**Пример размещения двух предметов в простом случае. На второй итерации маленький предмет просто сместился вправо (для сравнения, нарисована старая позиция). На третьей, после 
очередного перемещения вправо удается разместить в результате поворотов.**

<img src="data/dataset/all/ex_1.png" width="300" height="300" />
<img src="data/dataset/all/ex_2.png" width="300" height="300" />
<img src="data/dataset/all/ex_3.png" width="300" height="300" />

## Результат работы алгоритма:
True - Предметы можно разместить в многоугольнике <br>
False - Нет возможности разместить без пересечений предметов

## Разметка входных данных

Вертикальная ось геометрической плоскости направлена вниз.
Горизонтальная -- вправо.

**1. Многоугольник: {[6, 52], [51, 22], [86, 33], [43, 106]}**

<img src="data/dataset/mark/1_m.jpg" width="300" height="300" />

Результат: True

**2. Многоугольник: {[13, 50], [35, 5], [87, 20], [108, 43], [80, 85]}**

<img src="data/dataset/mark/7_m.jpg" width="300" height="300" />

Результат: False

**3. Многоугольник: {[1, 65], [63, 2], [138, 65]}**

<img src="data/dataset/mark/6_m.jpg" width="300" height="300" />

Результат: True

**4. Многоугольник: {[37, 63], [65, 51], [130, 96], [60, 102]}**

<img src="data/dataset/mark/4_m.jpg" width="300" height="300" />

Результат: False

**5. Многоугольник: {[4, 32], [45, 8], [93, 60], [72, 102], [45, 102]}**

<img src="data/dataset/mark/5_m.jpg" width="300" height="300" />

Результат: True